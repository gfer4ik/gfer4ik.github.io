<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>123</title>
</head>
<body>
<div>
struct collection
{
 char name[30];
 float cost;
 int quantity;
 int age1;
 int age2;
};
void add (char*);
void edit (char*);
void show(char*);
void search (char*);
void del (char*);
int main(int argc,char* argv[])
{
 SetConsoleCP(1251);
 SetConsoleOutputCP(1251);
 setlocale(LC_ALL,"Rus");
 char filename[50];
 int menu;
 puts("Имя создаваемого/открываемого файла");
 gets (filename);
 FILE *f;
 if ((f=fopen(filename,"ab"))==NULL)
 perror ("Ошибка создания/открытия файла");
 fclose(f);
 do
 {
 system("CLS");
 puts ("1. Добавление записи");
 puts ("2. Редактирование записи");
 puts ("3. Просмотр записей");
 puts ("4. Поиск");
 puts ("5. Удаление записи");
 puts ("6. Выход");
 scanf ("%d%*c",&menu);
 switch (menu)
 {
 case 1 : add (filename); break;
 case 2 : edit (filename); break;
 case 3 : show (filename); break;
 case 4 : search (filename);break;
 case 5 : del (filename);
 }
 }
 while (menu!=6);
 return 0;
}
struct collection input_toy (void)//ввод структуры
{
 struct collection toy;
 puts ("Название");
 gets(toy.name);
 puts ("Стоимость");
 while((scanf("%f",&toy.cost)==0)||toy.cost<0);
 {
 fflush(stdin);
 }
 puts ("Количество");
 scanf("%d",&toy.quantity);
 puts ("Возрастные границы от");
 while((scanf("%d", &toy.age1 )==0)||toy.age1<0)
 {
 printf("Ошибка ввода,введите число заново\n");
 fflush(stdin);
 puts ("Возрастные границы от");
 }
 puts ("Возрастные границы до");
 while((scanf("%d", &toy.age2 )==0)||toy.age2<0)
 {
 printf("Ошибка ввода,введите число заново\n");
 fflush(stdin);
 puts ("Возрастные границы до");
 }
 return toy;
}
void print1 (struct collection data) //вывод одной структуры на экран
{
 printf ("Название : %s\nСтоимость : %f\nКоличество : %d\nВозрастные границы
от : %d\nВозрастные границы до :
%d\n",data.name,data.cost,data.quantity,data.age1,data.age2);
}
void add(char* file)//добавление одной структуры в файл
{
 FILE *f;
 struct collection toy;
 setlocale(LC_ALL,"Rus");
 system ("CLS");
 if ((f=fopen(file,"ab"))==NULL)
 {
 perror ("Ошибка открытия файла");
 getchar();
 return;
 }
 toy = input_toy();
 fwrite(&toy, sizeof(toy),1,f);
 fclose(f);
}
void edit (char* file)//функция редактирования файла
{
 setlocale(LC_ALL,"Rus");
 FILE *f;
 struct collection toy;
 int cost;
 char name[30];
 char yes;
 system("CLS");
 if ((f=fopen (file,"rb+"))==NULL)
 {
 perror ("Ошибка открытия файла"); getchar();
 return;
 }
 printf("Имя: "); gets(name);
 while (fread(&toy,sizeof(toy),1,f))
 if (!strcmp(toy.name,name))
 {
 print1(toy);
 puts ("Редактировать?(y/n)");
 do
 {
 yes = getchar(); getchar();
 }
 while (yes!='y' && yes!='Y' && yes !='n' && yes!='N');
 if (yes=='y' || yes=='Y')
 {
 toy = input_toy();//вводим запись
 fseek(f,-sizeof(toy),SEEK_CUR);//перемещаемся к нужной структуре
 fwrite(&toy,sizeof(toy),1,f);
 fseek(f,0,SEEK_CUR);
 }
 }
 puts ("Поиск завершен"); getchar();
 fclose(f);
}
void show (char* file)//функция, показывающая все структуры в файле
{
 setlocale(LC_ALL,"Rus");
 FILE *f;
 struct collection toy;
 char menu,name[30]="Товар не найден";
 int k=0,i,n=0,age1=0,age2=0,kol=0;
 float Cost=0;
 long len;
 unsigned int num = 1, num_last;
 system("CLS");
 if((f=fopen(file,"rb"))==NULL)
 {
 perror("Ошибка открытия файла");
 getchar();
 return;
 }
 puts("| № | Название | Стоимость | Количество
| Возрастные границы |");
 puts("-------------------------------------------------------------------
---------------------------------");
 while (fread(&toy,sizeof(toy),1,f)==1){
 n=0;
 for(i=0;i<20;i++)
 {
 if
((toy.name[i]=='к'||toy.name[i]=='К')&&toy.name[i+1]=='о'&&toy.name[i+2]=='н'
&&

toy.name[i+3]=='с'&&toy.name[i+4]=='т'&&toy.name[i+5]=='р'&&toy.name[i+6]=='у
'&&toy.name[i+7]=='к'&&toy.name[i+8]=='т'&&toy.name[i+9]=='о'&&toy.name[i+10]
=='р')
 {
 n++;
break;
 }
 }
 if(Cost< toy .cost & &n){ Cost=toy.cost;
 strcpy(name,toy.name);
 age1=toy.age1;
 age2=toy.age2;
 kol=toy.quantity;
 }
 printf("|%4d|%24s|%20.2f|%22d| от %3d до %3d
|\n",++k,toy.name,toy.cost,toy.quantity,toy.age1,toy.age2);
 }
 puts("-------------------------------------------------------------------
---------------------------------");
 printf("Сведения о самом дорогом
конструкторе\nНазвание:%s\nЦена:%.2f\nКоличество:%d\nВозрастные границы:от %d
до %d",name,Cost,kol,age1,age2);
 fclose (f);
 getchar();
}
void search (char* file)//поиск нужной структуры по заданным параметрам
{
 setlocale(LC_ALL,"Rus");
 FILE *f;
 struct collection toy;
 int Cost,Age1=0,quan=0;
 int flag=0;
 char name[40];
 system("CLS");
 if((f=fopen(file,"rb"))==NULL)
 {
 perror("Ошибка открытия файла"); getchar();
 return;
 }
 puts("Стоимость?"); scanf("%d",&Cost);
 puts("Возрастные границы игрушки?"); scanf("%d",&Age1);
 puts("| Название | Стоимость | Количество |
Возрастные границы |");
 puts("-------------------------------------------------------------------
----------------------------");
 while (fread(&toy,sizeof(toy),1,f)==1){
 if ( toy.cost <=Cost && (toy.age1<=Age1 && toy.age2>=Age1))
 {
 printf("|%24s|%20.2f|%22d| от %3d до %3d
|\n",toy.name,toy.cost,toy.quantity,toy.age1,toy.age2);
 flag++;
 }
 }
 if (flag == 0) puts ("Подходящих игрушек нет");
 fclose(f);
 getchar();getchar();
}
void del(char*file)// функция удаления структуры
{
 setlocale(LC_ALL,"Rus");
 FILE *f1, *f2;
 unsigned int y,n_file,i=0,j=0,flag,age1,age2,quantity;
 float cost;
 char name[40];
 struct collection toy;
 system ("CLS");
 if ((f1=fopen(file,"r"))==NULL)
 {
 perror("Ошибка открытия файла"); getchar();
 return;
 }
 fseek(f1,0,SEEK_END);
 n_file = ftell(f1) / sizeof(toy);
 if (n_file == 0)
 {
 puts("Файл пуст"); getchar();
 return;
 }
 puts("Введите Название удаляемой записи?");
 scanf("%s",&name);
 puts("Введите стоимость удаляемой записи?");
 scanf("%f",&cost);
 puts("Введите количество удаляемой записи?");
 scanf("%u",&quantity);
 puts ("Введите возрастные границы удаляемой записи?");
 scanf("%u",&age1);
 scanf("%u",&age2);
 rewind(f1);
 if((f2=fopen("temp.dat","wb"))==NULL)
 {
 perror("Ошибка открытия файла");
 getchar();
 return;
 }
 while (fread(&toy,sizeof(toy),1,f1)==1)
 {
 flag=0;
 i++;
 if (strcmp(toy.name,name)==0)
 flag++;
 if (toy.cost==cost)
 flag++;
 if (toy.quantity==quantity)
 flag++;
 if (toy.age1==age1 && toy.age2==age2)
 flag++;
 if (flag!=4){
 fwrite (&toy,sizeof(toy),1,f2);
 j++;
 }
 }
 if (i!=j)
 puts("Запись удалена");
 else
 puts("Записи с такими данными не существует");
 fclose(f1);
 fclose(f2);
 remove(file);
  rename("temp.dat",file);
 getchar();getchar();
}
</div>
</body>
</html>